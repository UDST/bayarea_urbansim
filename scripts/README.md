# Script Docs

### backout_zoning.py

Backout zoning takes a range of runs and goes through the "parcel_output" files.
It will reverse engineer the max zoning that was used by new developments, which
is useful because we don't always use up to the max zoning allows so reporting the
actual max zoning can be misleading when sharing with stakeholders.

### check_data.py

This script could be the start of a data checking routine for base data (should be
remove from here if that script is written).  This script checks the relationships
between tabels are valid and alerts the user when there are unplaced households and
jobs in the base data.

### check_emp_totals.py

Checks to make sure employment sector totals add up to the total employment totals
for the taz and juris output.

### check_hh_totals.py

Does the same as the above for household categories and total household counts.

### check_rhna.py

Uses the file at data/rhna_by_juris.csv to make sure totals from an simulation run
exceed the RHNA totals.

### county_summaries.py

A script which computes basic summaries of households and jobs and units by county
and writes it to an Excel file (multiple worksheets for multiple runs).

### explorer.py

Run UrbanSim Explorer - takes a scenario number as an argument.  In theory this is done
every time the simulation runs (generates an output map to explore), so this only needs
to be run if something went wrong in generating that file.

### export.py

Combine a couple of dataframes, all keyed on parcel_id, keep important attribuets, and
write out a csv of parcel-level attributes for use in other tools.

### filter_large_projects.py

Take a parcel_output file generated by UrbanSim and only keep the projects which are very
large - we should review these by hand.

### fix_zoning_missing_id.py

This is Tom's code.

This script was written to find parcels that have a zoning name assigned to them but which don't have an entry in the `data/zoning_lookup.csv`. Example instances of where this might happen are if a city adds a newly named zoning code or where we might not have assigned zoning at all, which seems to have happened often with parks, the working assumption being that a park would never be re-developed. This is probably an assumption worth testing. 

To use it, run:

`python scripts/fix_zoning_missing_id.py`

The script will print out a summary of parcels with null zoning values by city. It will also look up strings for each city in the zoning_lookup.csv `name` column and then assign the appropriate id if its finds one. Note that it will write the results back out to a `zoning_parcels.csv` file preceded by todays date. 

### import_mongo.py

This is not used, but is pretty awesome.  It gets numpy arrays from Mongo and is very fast - use
if ever storing data in Mongo.

### make_net_from_shapefile.py

This is an example script which converts travel model output stored as a shapefile into a network
suitable for using in Pandana.

### make_shapefile.py

This is an example which takes a parcel csv and writes it out as a shapefile using geopandas.

### match_city_totals.py

This is also a base year issue.  Near the end of the last Plan we received updated household
totals per city from ABAG.  We didn't want to do an entirely new assignment, so we used
this script to "move" households from cities where the totals lowered into adjacent areas.
This produced the file household_building_overrides.csv which shows which households move
where.  It's very likely do a new assignment soon and this script and the overrides csv
can both go away.

### parcel_output_diff.py

Compares two parcel_output files from different runs to report the differences.  Because
UrbanSim is very stochastic, differences can be fairly large.

### serve_json.py

Also not used anymore, but serves this UrbanSim data as json in case there's a need for accessing
the data using a webapp.

### vmt_compare.py
Compare the household totals for two scenarios inside different VMT zones.  This is used
to see if our VMT impact fees were successful in moving households out of higher VMT
areas.

## build_strategy.ipynb
* build development-related strategy settings in `policy.yaml`
* inclusionary housing setting: for Final Blueprint, reads `parcels_geography.csv` input, categorizes fbpchcat based on required inclusionary level. 
* office lump sum subsidies: for Final Blueprint, creates account setting for receiving jurisdictions. 